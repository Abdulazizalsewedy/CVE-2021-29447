# Wordpress: CVE-2021-29447 

Vulnerability allow a authenticated user whith low privilages upload a malicious WAVE file that could lead to arbitrary file disclosure

#  Technical Details

XML External Entity (XXE) Vulnerabilities

XML offers the possibility to define custom entities that can be reused throughout a document. This can, for example, be used to avoid duplication. 
The following code defines an entity myEntity for further usage.

![1](https://user-images.githubusercontent.com/64151982/202497991-87be7229-0348-4a5a-a4ea-ce1edc3ac440.PNG)

The value of defined entities can also stem from an external source referenced by a URI. In this case, they are called external entities:

![2](https://user-images.githubusercontent.com/64151982/202499012-872eb4c6-aae8-42bc-995d-755726650e26.PNG)

XXE attacks misuse this feature. They are possible when a loosely configured XML parser is run on user-controlled content. 
Loosely configured usually means that all entities are substituted with their corresponding value in the result. For example, 
in the last sample, if an attacker would supply file:///var/www/wp-config.php as the URI and is able to view the result of the 
parsed XML, she would successfully leak sensitive file content.

XXE in WordPress

WordPress has a Media Library that enables authenticated users to upload media files that can then be used in their blog posts. 
To extract meta information from these media files, e.g., artist name or title, WordPress uses the getID3 library. Some of this 
metadata is parsed in XML form. Here, it was reported a possible XXE vulnerability (line 730).

![3](https://user-images.githubusercontent.com/64151982/202502235-290405ec-625c-405b-97e4-f29abf68a55b.PNG)


# Exploitation

Creating a malicious WAVE file using following command

![4](https://user-images.githubusercontent.com/64151982/202817877-0a85cfeb-a1a6-487f-80e6-9f7705daa154.PNG)

Create a dtd file and then add this code, this will allow us to retrieved the wp-config.php which contains sensitive data such as database credentials.

![5](https://user-images.githubusercontent.com/64151982/202819386-8b42c035-a4b9-4e91-8547-8e28e9dce5b7.PNG)

Now launch an http server 

![6](https://user-images.githubusercontent.com/64151982/202820687-d8855214-78f8-4c64-87d8-873ad547ccf2.PNG)

Upload the malicious .wav to the WordPress application

![7](https://user-images.githubusercontent.com/64151982/202821052-cb97e42d-80b8-4a1a-87f4-9b6f40ddd41b.PNG)

Once you've uploaded the .wav file, you should see the following request in your HTTP server logs. Note, in order to exfiltrate data effectively I used Zlib for dcoding. 

![8](https://user-images.githubusercontent.com/64151982/202821938-89fd075c-45ab-4d09-9299-48bbc3876b2d.PNG)



# Fix

# Resources:


